<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東京旅遊。旗艦攻略 - Tokyo Wanderlust</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --jp-red: #bc002d;
            --wash-white: #fdfdfd;
            --ink-black: #2b2d42;
            --bg: var(--wash-white);
            --card: rgba(255,255,255,0.95);
            --text: var(--ink-black);
            --border: rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg: #0b1020;
            --card: rgba(255,255,255,.08);
            --text: rgba(255,255,255,.92);
            --border: rgba(255,255,255,.14);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: 0.3s;
        }

        h1, h2, h3, .serif { font-family: 'Noto Serif TC', serif; }

        /* Navbar */
        .navbar {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.8) !important;
            border-bottom: 1px solid var(--border);
        }
        [data-theme="dark"] .navbar { background: rgba(0,0,0,.35) !important; }

        /* Hero Carousel */
        .hero-carousel img {
            height: 65vh;
            object-fit: cover;
        }

        /* Weather Section */
        .weather-section {
            background: var(--card);
            margin-top: -50px;
            box-shadow: 0 15px 45px rgba(0,0,0,0.1);
            position: relative; z-index: 10;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        /* Card System */
        .spot-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 15px;
            overflow: hidden;
            transition: 0.3s;
        }
        .spot-card:hover { transform: translateY(-10px); border-color: var(--jp-red); }
        .spot-img { height: 220px; object-fit: cover; }

        /* Planner */
        .plan-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px; border: 1px solid var(--border);
            border-radius: 12px; background: var(--card); margin-bottom: 10px;
        }

        #google-mini-map { height: 250px; width: 100%; border-radius: 10px; }
        #toTop { position: fixed; bottom: 20px; right: 20px; z-index: 99; background: var(--jp-red); color: white; border: none; padding: 10px 15px; border-radius: 5px; opacity: 0; transition: 0.3s; }
        #toTop.show { opacity: 1; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-danger" href="#">TOKYO TRAVEL GUIDE</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item px-2"><a class="nav-link" href="#weather">實時氣象</a></li>
                    <li class="nav-item px-2"><a class="nav-link" href="#spots">探索景點</a></li>
                    <li class="nav-item px-2"><a class="nav-link" href="#planner">行程規劃</a></li>
                    <li class="nav-item ms-lg-3">
                        <button id="themeBtn" class="btn btn-outline-danger btn-sm">切換主題</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="heroCarousel" class="carousel slide hero-carousel" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=1600&q=80" class="d-block w-100" alt="東京鐵塔">
            </div>
            <div class="carousel-item">
                <img src="https://images.unsplash.com/photo-1503899036084-c55cdd92da26?auto=format&fit=crop&w=1600&q=80" class="d-block w-100" alt="新宿夜景">
            </div>
        </div>
        <div class="container position-absolute top-50 start-50 translate-middle text-center text-white" style="z-index: 5;">
            <h1 class="display-3 fw-bold serif" style="text-shadow: 2px 2px 15px rgba(0,0,0,0.5);">再發現。東京</h1>
            <p class="lead">穿梭於江戶情懷與未來都市之間</p>
        </div>
    </div>

    <div class="container" id="weather">
        <div class="weather-section" data-aos="fade-up">
            <div class="row align-items-center border-bottom pb-3 mb-4">
                <div class="col-6">
                    <h3 class="serif fw-bold mb-0"><i class="bi bi-geo-alt-fill text-danger"></i> 東京。實時氣象</h3>
                </div>
                <div class="col-6 text-end">
                    <div class="d-flex justify-content-end align-items-center">
                        <img id="current-icon" src="" width="60">
                        <div class="ms-2 text-start">
                            <h2 id="current-temp" class="fw-bold mb-0">--°C</h2>
                            <p id="current-desc" class="text-muted small mb-0">資料同步中...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="forecast-container" class="row g-2 justify-content-center">
                <div class="text-center py-2 text-muted small">正在連接 OpenWeather One Call 3.0 (每日限制 1,000 次已生效)...</div>
            </div>
        </div>
    </div>

    <section id="spots" class="container py-5 mt-5">
        <div class="d-flex flex-wrap justify-content-between align-items-end mb-4" data-aos="fade-up">
            <div>
                <h2 class="serif fw-bold display-6">深度景點探索</h2>
                <p class="text-muted">點擊卡片收藏或加入行程</p>
            </div>
            <div class="d-flex gap-2">
                <input id="searchInput" class="form-control" style="width: 250px;" placeholder="搜尋景點名稱...">
                <select id="categorySelect" class="form-select">
                    <option value="all">所有類別</option>
                    <option value="culture">文化傳統</option>
                    <option value="trend">潮流購物</option>
                    <option value="anime">動漫文化</option>
                </select>
            </div>
        </div>
        <div class="row g-4" id="spotsGrid"></div>
    </section>

    <section id="planner" class="container py-5">
        <div class="row g-4">
            <div class="col-lg-7" data-aos="fade-right">
                <div class="weather-section h-100">
                    <h4 class="fw-bold serif mb-4">我的行程規劃</h4>
                    <div id="planList" class="d-flex flex-column gap-2"></div>
                    <div id="planEmpty" class="text-muted text-center py-4">目前行程是空的，去上面挑選景點吧！</div>
                    <button id="btnExport" class="btn btn-danger w-100 mt-3 rounded-pill">匯出規劃清單</button>
                </div>
            </div>
            <div class="col-lg-5" data-aos="fade-left">
                <div class="weather-section h-100">
                    <h4 class="fw-bold serif mb-3">收藏清單</h4>
                    <div id="favList"></div>
                    <div id="favEmpty" class="text-muted text-center">尚未收藏任何景點。</div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-dark text-white py-4 mt-5 text-center">
        <p class="mb-1">API: OpenWeather (UK) & Google Maps (USA)｜無大陸品牌組件 </p>
        <p class="small text-secondary mb-0">© 2025 Tokyo Travel Guide 作業學術使用 [cite: 119]</p>
    </footer>

    <button id="toTop">↑</button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA2DLTV1iolBo5XCrGPofVJIof4DW2marE" async defer></script>

    <script>
        // --- 核心數據 ---
        const WEATHER_KEY = '1a2807cc2da97931d066c115631af03d'; // 
        const LAT = 35.6895, LON = 139.6917;

        const spots = [
            { id: "asakusa", name: "淺草寺", category: "culture", area: "台東區", rating: 4.7, time: "2-3 小時", img: "https://images.unsplash.com/photo-1590559899731-a382839e5549?auto=format&fit=crop&w=800&q=80", desc: "東京最古老的寺院，著名的雷門與仲見世通。", lat: 35.7148, lng: 139.7967 },
            { id: "shibuya", name: "澀谷十字路口", category: "trend", area: "澀谷區", rating: 4.6, time: "1-2 小時", img: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800&q=80", desc: "全球最繁忙路口，體驗潮流與生命力。", lat: 35.6585, lng: 139.7013 },
            { id: "meiji", name: "明治神宮", category: "culture", area: "澀谷區", rating: 4.8, time: "2-3 小時", img: "https://images.unsplash.com/photo-1542931287-023b922fa89b?auto=format&fit=crop&w=800&q=80", desc: "隱身都市中的神聖森林。", lat: 35.6764, lng: 139.6993 },
            { id: "akiba", name: "秋葉原", category: "anime", area: "千代田區", rating: 4.5, time: "3-5 小時", img: "https://images.unsplash.com/photo-1554797589-7241bb691973?auto=format&fit=crop&w=800&q=80", desc: "動漫愛好者的天堂。", lat: 35.6983, lng: 139.7731 }
        ];

        let favSet = new Set(JSON.parse(localStorage.getItem('tokyoFav') || "[]"));
        let plan = JSON.parse(localStorage.getItem('tokyoPlan') || "[]");

        AOS.init();

        // --- 氣象功能 ---
        async function updateWeather() {
            try {
                const url = `https://api.openweathermap.org/data/3.0/onecall?lat=${LAT}&lon=${LON}&appid=${WEATHER_KEY}&units=metric&lang=zh_tw`; // 
                const res = await fetch(url);
                const data = await res.json();
                document.getElementById('current-temp').innerText = `${Math.round(data.current.temp)}°C`;
                document.getElementById('current-desc').innerText = data.current.weather[0].description;
                document.getElementById('current-icon').src = `https://openweathermap.org/img/wn/${data.current.weather[0].icon}@2x.png`;
                
                const container = document.getElementById('forecast-container');
                container.innerHTML = '';
                data.daily.slice(0, 7).forEach((day, i) => {
                    const date = new Date(day.dt * 1000);
                    container.innerHTML += `
                        <div class="col px-1 text-center border-end">
                            <div class="small fw-bold">${i === 0 ? '今日' : (date.getMonth()+1)+'/'+date.getDate()}</div>
                            <img src="https://openweathermap.org/img/wn/${day.weather[0].icon}.png" width="30">
                            <div class="small text-danger">${Math.round(day.temp.max)}°</div>
                            <div class="small text-muted">${Math.round(day.temp.min)}°</div>
                        </div>`;
                });
            } catch (e) { console.log("氣象同步中..."); }
        }

        // --- 核心渲染 ---
        function renderGrid() {
            const grid = document.getElementById('spotsGrid');
            const search = document.getElementById('searchInput').value.toLowerCase();
            const cat = document.getElementById('categorySelect').value;
            
            grid.innerHTML = '';
            spots.filter(s => (cat === 'all' || s.category === cat) && s.name.includes(search)).forEach(s => {
                grid.innerHTML += `
                    <div class="col-md-6 col-lg-3">
                        <div class="spot-card h-100">
                            <img src="${s.img}" class="spot-img w-100">
                            <div class="p-3">
                                <div class="d-flex justify-content-between">
                                    <h5 class="fw-bold">${s.name}</h5>
                                    <button class="btn btn-sm btn-outline-danger border-0" onclick="toggleFav('${s.id}')">
                                        ${favSet.has(s.id) ? '♥' : '♡'}
                                    </button>
                                </div>
                                <p class="text-muted small">${s.desc}</p>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-danger btn-sm" onclick="showDetail('${s.id}')">了解更多</button>
                                    <button class="btn btn-danger btn-sm" onclick="addToPlan('${s.id}')" ${plan.includes(s.id)?'disabled':''}>
                                        ${plan.includes(s.id)?'已加入':'加入行程'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>`;
            });
        }

        // --- 功能模組 ---
        function showDetail(id) {
            const s = spots.find(x => x.id === id);
            Swal.fire({
                title: `<h3 class="serif fw-bold">${s.name}</h3>`,
                html: `<img src="${s.img}" class="img-fluid rounded mb-3" style="height:200px; object-fit:cover; width:100%;">
                       <p class="small text-start">${s.desc}</p>
                       <div id="google-mini-map"></div>`,
                didOpen: () => {
                    if (typeof google !== 'undefined') {
                        const loc = { lat: s.lat, lng: s.lng };
                        const map = new google.maps.Map(document.getElementById("google-mini-map"), { zoom: 15, center: loc, disableDefaultUI: true });
                        new google.maps.Marker({ position: loc, map: map });
                    }
                },
                confirmButtonText: '查看導航', confirmButtonColor: '#bc002d'
            }).then(r => { if(r.isConfirmed) window.open(`https://www.google.com/maps/search/?api=1&query=${s.lat},${s.lng}`); });
        }

        function toggleFav(id) {
            if (favSet.has(id)) favSet.delete(id); else favSet.add(id);
            localStorage.setItem('tokyoFav', JSON.stringify([...favSet]));
            renderFav(); renderGrid();
        }

        function renderFav() {
            const list = document.getElementById('favList');
            const arr = [...favSet].map(id => spots.find(s => s.id === id)).filter(Boolean);
            document.getElementById('favEmpty').style.display = arr.length ? 'none' : 'block';
            list.innerHTML = arr.map(s => `
                <div class="plan-item small">
                    <span class="fw-bold">${s.name}</span>
                    <button class="btn btn-sm btn-link text-danger" onclick="toggleFav('${s.id}')">移除</button>
                </div>`).join('');
        }

        function addToPlan(id) {
            if (!plan.includes(id)) { plan.push(id); localStorage.setItem('tokyoPlan', JSON.stringify(plan)); renderPlan(); renderGrid(); }
        }

        function renderPlan() {
            const list = document.getElementById('planList');
            document.getElementById('planEmpty').style.display = plan.length ? 'none' : 'block';
            list.innerHTML = plan.map((id, i) => {
                const s = spots.find(x => x.id === id);
                return `
                    <div class="plan-item">
                        <div><small class="text-danger fw-bold me-2">D${i+1}</small>${s.name}</div>
                        <button class="btn btn-sm btn-outline-secondary border-0" onclick="removeFromPlan(${i})">✕</button>
                    </div>`;
            }).join('');
        }

        function removeFromPlan(idx) { plan.splice(idx, 1); localStorage.setItem('tokyoPlan', JSON.stringify(plan)); renderPlan(); renderGrid(); }

        // --- 事件監聽 ---
        document.getElementById('themeBtn').onclick = () => {
            const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
        };
        document.getElementById('searchInput').oninput = renderGrid;
        document.getElementById('categorySelect').onchange = renderGrid;
        window.onscroll = () => document.getElementById('toTop').classList.toggle('show', window.scrollY > 600);
        document.getElementById('toTop').onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });

        // --- 初始化 ---
        updateWeather(); renderGrid(); renderFav(); renderPlan();
    </script>
</body>
</html>
