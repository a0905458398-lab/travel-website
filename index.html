<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬æ—…éŠã€‚æ——è‰¦æ”»ç•¥ 2025 - Tokyo Wanderlust</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --jp-red: #bc002d; --wash-white: #fdfdfd; --ink-black: #2b2d42;
            --bg: var(--wash-white); --text: var(--ink-black); --border: rgba(0,0,0,0.1);
            --card: rgba(255,255,255,0.95);
        }
        [data-theme="dark"] {
            --bg: #0b1020; --text: rgba(255,255,255,.92); --border: rgba(255,255,255,.14);
            --card: rgba(255,255,255,.08);
        }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); color: var(--text); transition: 0.3s; scroll-behavior: smooth; }
        h1, h2, h3, h4, .serif { font-family: 'Noto Serif TC', serif; }
        .navbar { backdrop-filter: blur(15px); background: rgba(255, 255, 255, 0.8) !important; border-bottom: 1px solid var(--border); }
        [data-theme="dark"] .navbar { background: rgba(0,0,0,.35) !important; }
        .hero-carousel img { height: 55vh; object-fit: cover; filter: brightness(0.8); }
        .glass-panel { background: var(--card); border: 1px solid var(--border); border-radius: 18px; backdrop-filter: blur(14px); padding: 30px; margin-bottom: 30px; }
        .weather-banner { margin-top: -50px; position: relative; z-index: 10; }
        .spot-card { background: var(--card); border: 1px solid var(--border); border-radius: 15px; overflow: hidden; transition: 0.3s; cursor: pointer; }
        .spot-card:hover { transform: translateY(-8px); border-color: var(--jp-red); }
        .spot-img { height: 220px; object-fit: cover; }
        
        /* è¡Œç¨‹æ¡†æ¡† UI [cite: 77, 181] */
        .plan-item { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 15px; border: 2px solid var(--border); 
            border-radius: 12px; background: var(--card); margin-bottom: 12px;
            transition: 0.2s;
        }
        .plan-item:hover { border-color: var(--jp-red); background: rgba(188, 0, 45, 0.05); }

        #google-mini-map { height: 250px; width: 100%; border-radius: 12px; border: 1px solid var(--border); margin-top: 15px; }
        #toTop { position: fixed; bottom: 25px; right: 25px; z-index: 99; background: var(--jp-red); color: white; border: none; padding: 10px 15px; border-radius: 8px; opacity: 0; transition: 0.3s; }
        #toTop.show { opacity: 1; }

        .table-custom { background: var(--card); border-radius: 12px; overflow: hidden; }
        .table-custom thead { background: var(--ink-black); color: white; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-danger" href="#">TOKYO FLAGSHIP 2025</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto align-items-center fw-bold">
                    <li class="nav-item px-2"><a class="nav-link" href="#weather">æ°£è±¡</a></li>
                    <li class="nav-item px-2"><a class="nav-link" href="#spots">æ¢ç´¢</a></li>
                    <li class="nav-item px-2"><a class="nav-link" href="#data-center">æ•¸æ“šåº«</a></li>
                    <li class="nav-item px-2"><a class="nav-link" href="#planner">æˆ‘çš„è¡Œç¨‹</a></li>
                    <li class="nav-item ms-lg-3"><button id="themeBtn" class="btn btn-outline-danger btn-sm">åˆ‡æ›ä¸»é¡Œ</button></li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active"><img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=1600&q=80" class="d-block w-100"></div>
            <div class="carousel-item"><img src="https://images.unsplash.com/photo-1503899036084-c55cdd92da26?auto=format&fit=crop&w=1600&q=80" class="d-block w-100"></div>
        </div>
        <div class="container position-absolute top-50 start-50 translate-middle text-center text-white">
            <h1 class="display-3 fw-bold serif">å†ç™¼ç¾ã€‚æ±äº¬</h1>
            <p class="fs-4">å°ˆæ¥­è¡Œç¨‹è¦åŠƒèˆ‡æ•¸æ“šç³»çµ±</p>
        </div>
    </div>

    <div class="container weather-banner" id="weather">
        <div class="glass-panel" data-aos="fade-up">
            <div class="row align-items-center mb-4 border-bottom pb-3">
                <div class="col-6"><h3 class="serif fw-bold mb-0">æ±äº¬ã€‚å³æ™‚æ°£è±¡</h3></div>
                <div class="col-6 text-end">
                    <div class="d-flex justify-content-end align-items-center">
                        <img id="current-icon" src="" width="60">
                        <div class="ms-2 text-start"><h2 id="current-temp" class="fw-bold mb-0">--Â°C</h2><p id="current-desc" class="text-muted small mb-0">åŒæ­¥ä¸­...</p></div>
                    </div>
                </div>
            </div>
            <div id="forecast-container" class="row g-2"></div>
        </div>
    </div>

    <section id="spots" class="container py-5">
        <h2 class="serif fw-bold mb-4" data-aos="fade-up">ç†±é–€æ™¯é»å°è¦½</h2>
        <div class="row g-4" id="spotsGrid"></div>
    </section>

    <section id="data-center" class="container py-5">
        <div class="glass-panel" data-aos="fade-up">
            <h4 class="serif fw-bold mb-4">ğŸ® æ™¯é»æ•¸æ“šåˆ†æåº« (å³æ™‚æœå°‹)</h4>
            <input type="text" id="tableSearch" class="form-control mb-3" placeholder="æœå°‹æ™¯é»ã€å€åŸŸæˆ–é¡å‹...">
            <div class="table-responsive">
                <table class="table table-custom mb-0">
                    <thead><tr><th>ID</th><th>åç¨±</th><th>åˆ†é¡</th><th>åœç•™</th><th>å€åŸŸ</th><th>è©•åˆ†</th></tr></thead>
                    <tbody id="spotTableBody"></tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="planner" class="container py-5">
        <div class="row g-4">
            <div class="col-lg-8" data-aos="fade-right">
                <div class="glass-panel h-100">
                    <h4 class="fw-bold serif mb-4">æˆ‘çš„è¡Œç¨‹è·¯ç·šåœ–</h4>
                    <div id="planList"></div>
                    <div id="planEmpty" class="text-muted text-center py-5 border rounded-3 border-dashed">è¡Œç¨‹æ¸…å–®ç›®å‰æ˜¯ç©ºçš„ï¼Œå¿«å»æ”¶è—æ™¯é»å§ï¼</div>
                    <button id="btnExport" class="btn btn-danger w-100 mt-4 rounded-pill py-2 fw-bold">åŒ¯å‡ºæˆ‘çš„è¦åŠƒæ¸…å–® (ç´”æ–‡å­—)</button>
                </div>
            </div>
            <div class="col-lg-4" data-aos="fade-left">
                <div class="glass-panel h-100">
                    <h4 class="fw-bold serif mb-3">æ”¶è—æ¸…å–®</h4>
                    <div id="favList"></div>
                    <div id="favEmpty" class="text-muted text-center py-3">å°šæœªæœ‰æ”¶è—ã€‚</div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-dark text-white py-4 text-center mt-5">
        <p class="small mb-0">API: OpenWeather & Google Mapsï½œç„¡å¤§é™¸å“ç‰Œçµ„ä»¶ï½œ2025 æœŸæœ«å°ˆæ¡ˆ [cite: 119]</p>
    </footer>

    <button id="toTop">â†‘</button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA2DLTV1iolBo5XCrGPofVJIof4DW2marE" async defer></script>

    <script>
        const WEATHER_KEY = '1a2807cc2da97931d066c115631af03d'; // [cite: 28]
        const LAT = 35.6895, LON = 139.6917; // [cite: 29]

        // è³‡æ–™åº«ï¼šç¢ºä¿ ID æ˜¯æ•¸å­—é¡å‹ [cite: 122]
        const spots = [
            { id: 1, name: "æ·ºè‰å¯º", category: "culture", area: "å°æ±å€", rating: 4.7, time: "3 å°æ™‚", img: "https://images.unsplash.com/photo-1590559899731-a382839e5549?auto=format&fit=crop&w=800&q=80", desc: "æ±äº¬æœ€å¤è€çš„å¯ºå»Ÿï¼Œè‘—åçš„é›·é–€æ‰€åœ¨åœ°ã€‚", lat: 35.7148, lng: 139.7967 },
            { id: 2, name: "æ¾€è°·åå­—è·¯å£", category: "trend", area: "æ¾€è°·å€", rating: 4.6, time: "1 å°æ™‚", img: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800&q=80", desc: "å…¨çƒæœ€ç¹å¿™çš„åå­—è·¯å£ã€‚", lat: 35.6585, lng: 139.7013 },
            { id: 3, name: "æ˜æ²»ç¥å®®", category: "culture", area: "æ¾€è°·å€", rating: 4.8, time: "2 å°æ™‚", img: "https://images.unsplash.com/photo-1542931287-023b922fa89b?auto=format&fit=crop&w=800&q=80", desc: "éƒ½å¸‚ä¸­çš„éœè¬æ£®æ—ã€‚", lat: 35.6764, lng: 139.6993 },
            { id: 4, name: "ç§‹è‘‰åŸ", category: "anime", area: "åƒä»£ç”°å€", rating: 4.5, time: "5 å°æ™‚", img: "https://images.unsplash.com/photo-1554797589-7241bb691973?auto=format&fit=crop&w=800&q=80", desc: "å‹•æ¼«æ„›å¥½è€…çš„å¤©å ‚ã€‚", lat: 35.6983, lng: 139.7731 },
            { id: 5, name: "æ±äº¬éµå¡”", category: "trend", area: "æ¸¯å€", rating: 4.9, time: "2 å°æ™‚", img: "https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=800&q=80", desc: "æ±äº¬æœ€å…·ä»£è¡¨æ€§çš„æ¨™èªŒã€‚", lat: 35.6586, lng: 139.7454 }
        ];

        let favSet = new Set(JSON.parse(localStorage.getItem('tokyoFav') || "[]")); // [cite: 131]
        let plan = JSON.parse(localStorage.getItem('tokyoPlan') || "[]"); // [cite: 132]

        AOS.init();

        // æ°£è±¡åŠŸèƒ½ [cite: 30, 35]
        async function fetchWeather() {
            try {
                const res = await fetch(`https://api.openweathermap.org/data/3.0/onecall?lat=${LAT}&lon=${LON}&appid=${WEATHER_KEY}&units=metric&lang=zh_tw`);
                const data = await res.json();
                document.getElementById('current-temp').innerText = `${Math.round(data.current.temp)}Â°C`;
                document.getElementById('current-desc').innerText = data.current.weather[0].description;
                document.getElementById('current-icon').src = `https://openweathermap.org/img/wn/${data.current.weather[0].icon}@2x.png`;
                const fc = document.getElementById('forecast-container'); fc.innerHTML = '';
                data.daily.slice(0, 7).forEach((day, i) => {
                    const date = new Date(day.dt * 1000);
                    fc.innerHTML += `<div class="col px-1 text-center border-end">
                        <div class="small fw-bold">${i===0?'ä»Šæ—¥':(date.getMonth()+1)+'/'+date.getDate()}</div>
                        <img src="https://openweathermap.org/img/wn/${day.weather[0].icon}.png" width="30">
                        <div class="small text-danger">${Math.round(day.temp.max)}Â°</div>
                    </div>`;
                });
            } catch (e) { console.log("æ°£è±¡åŒæ­¥ä¸­..."); }
        }

        // æ ¸å¿ƒæ¸²æŸ“ä¿®å¾©ï¼šåŠ å…¥ Number() è½‰æ›é˜²æ­¢é¡å‹è¡çª [cite: 153, 179]
        function renderAll() {
            try {
                // 1. å¡ç‰‡
                const grid = document.getElementById('spotsGrid');
                grid.innerHTML = spots.map(s => `
                    <div class="col-md-4">
                        <div class="spot-card">
                            <img src="${s.img}" class="spot-img w-100" onclick="showDetail(${s.id})">
                            <div class="p-3">
                                <div class="d-flex justify-content-between">
                                    <h5 class="fw-bold">${s.name}</h5>
                                    <button class="btn btn-sm btn-outline-danger border-0" onclick="toggleFav(${s.id})">${favSet.has(s.id)?'â™¥':'â™¡'}</button>
                                </div>
                                <button class="btn btn-danger btn-sm w-100 mt-2 rounded-pill" onclick="addToPlan(${s.id})" ${plan.map(Number).includes(Number(s.id))?'disabled':''}>
                                    ${plan.map(Number).includes(Number(s.id))?'å·²åœ¨è¡Œç¨‹ä¸­':'åŠ å…¥è¡Œç¨‹'}
                                </button>
                            </div>
                        </div>
                    </div>`).join('');

                // 2. è¡¨æ ¼ (Demo æ•´åˆç‰ˆ)
                const kw = document.getElementById('tableSearch').value.toLowerCase();
                const tableBody = document.getElementById('spotTableBody');
                tableBody.innerHTML = spots.filter(s => s.name.includes(kw) || s.area.includes(kw)).map(s => 
                    `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.category}</td><td>${s.time}</td><td>${s.area}</td><td class="text-danger">â˜… ${s.rating}</td></tr>`
                ).join('');

                // 3. è¡Œç¨‹è¦åŠƒåˆ—è¡¨ (ä¿®å¾©æ¡†æ¡†æ²’å‡ºä¾†çš„å•é¡Œ) 
                const planL = document.getElementById('planList');
                document.getElementById('planEmpty').style.display = plan.length ? 'none' : 'block';
                planL.innerHTML = plan.map((id, i) => {
                    const s = spots.find(x => Number(x.id) === Number(id)); // å¼·åˆ¶æ•¸å­—è½‰æ› 
                    if(!s) return ''; 
                    return `
                    <div class="plan-item">
                        <div><span class="badge bg-danger me-2">D${i+1}</span><strong>${s.name}</strong> (${s.area})</div>
                        <button class="btn btn-sm btn-outline-secondary border-0" onclick="removeFromPlan(${i})">âœ•</button>
                    </div>`;
                }).join('');

                // 4. æ”¶è—æ¸…å–®
                const favL = document.getElementById('favList');
                const favArr = [...favSet].map(id => spots.find(s => Number(s.id) === Number(id))).filter(Boolean);
                document.getElementById('favEmpty').style.display = favArr.length ? 'none' : 'block';
                favL.innerHTML = favArr.map(s => `<div class="plan-item small"><span>${s.name}</span><button class="btn btn-sm text-danger" onclick="toggleFav(${s.id})">ç§»é™¤</button></div>`).join('');
            } catch (err) { console.error("æ¸²æŸ“ç™¼ç”ŸéŒ¯èª¤:", err); }
        }

        // åŠŸèƒ½ä¿®å¾©ï¼šåŠ å…¥è¡Œç¨‹ [cite: 164]
        function addToPlan(id) {
            const numId = Number(id);
            if(!plan.map(Number).includes(numId)) { 
                plan.push(numId); 
                localStorage.setItem('tokyoPlan', JSON.stringify(plan)); 
                renderAll();
                Swal.fire({ icon: 'success', title: 'æˆåŠŸï¼', text: 'æ™¯é»å·²åŠ å…¥è¡Œç¨‹æ¸…å–®ã€‚', timer: 1200, showConfirmButton: false });
            }
        }

        function removeFromPlan(idx) {
            plan.splice(idx, 1);
            localStorage.setItem('tokyoPlan', JSON.stringify(plan));
            renderAll();
        }

        function toggleFav(id) {
            const numId = Number(id);
            if(favSet.has(numId)) favSet.delete(numId); else favSet.add(numId);
            localStorage.setItem('tokyoFav', JSON.stringify([...favSet]));
            renderAll();
        }

        // åŒ¯å‡ºåŠŸèƒ½ä¿®å¾©ï¼šå½ˆçª—èˆ‡è¤‡è£½åŠŸèƒ½ 
        document.getElementById('btnExport').onclick = function() {
            if(plan.length === 0) { Swal.fire('è¡Œç¨‹ç‚ºç©º', 'å¿«å»ä¸Šé¢çš„å¡ç‰‡é»æ“ŠåŠ å…¥å§ï¼', 'warning'); return; }
            let text = "ğŸ—ºï¸ æˆ‘çš„æ±äº¬æ™‚å…‰æ¼«æ­¥è¡Œç¨‹ï¼š\n\n";
            plan.forEach((id, i) => {
                const s = spots.find(x => Number(x.id) === Number(id));
                if(s) text += `[Day ${i+1}] ${s.name} (${s.area}) - åœç•™å»ºè­°: ${s.time}\n`;
            });
            Swal.fire({
                title: 'è¡Œç¨‹è¦åŠƒåŒ¯å‡º',
                html: `<textarea class="form-control" rows="8" readonly>${text}</textarea>`,
                confirmButtonText: 'è¤‡è£½æ–‡å­—', confirmButtonColor: '#bc002d'
            }).then(() => {
                navigator.clipboard.writeText(text);
                Swal.fire('å·²è¤‡è£½ï¼', 'ä½ å¯ä»¥å°‡è¡Œç¨‹åˆ†äº«çµ¦æœ‹å‹äº†ã€‚', 'success');
            });
        }

        // åœ°åœ–å½ˆçª— [cite: 35, 166]
        function showDetail(id) {
            const s = spots.find(x => Number(x.id) === Number(id));
            Swal.fire({
                title: `<h3 class="serif fw-bold">${s.name}</h3>`,
                html: `<img src="${s.img}" class="img-fluid rounded mb-2" style="height:200px; width:100%; object-fit:cover;"><div id="google-mini-map"></div>`,
                didOpen: () => {
                    const loc = { lat: s.lat, lng: s.lng };
                    const map = new google.maps.Map(document.getElementById("google-mini-map"), { zoom: 15, center: loc, disableDefaultUI: true });
                    new google.maps.Marker({ position: loc, map: map });
                }
            });
        }

        // åˆå§‹åŒ–
        document.getElementById('themeBtn').onclick = () => {
            const t = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', t);
        };
        document.getElementById('tableSearch').oninput = renderAll;
        fetchWeather(); renderAll();
    </script>
</body>
</html>
